<!DOCTYPE html>
<html>

<head>
	<title>gtd</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<script src="/axios.min.js"></script>
	<script src="/marked.min.js"></script>
</head>

<body>
	<pre id="textarea" readonly></pre>

	<style>
		#textarea {
			width: 100%;
			height: 600px;
			border: none;
			resize: none;
			font-size: 22px;
			margin-left: 5px;
			margin-top: 0px;
		}

		body,
		#textarea {
			background-color: #000000;
			color: #ffffff;
		}

		pre {
			overflow-x: auto;
			white-space: pre-wrap;
			white-space: -moz-pre-wrap;
			white-space: -pre-wrap;
			white-space: -o-pre-wrap;
			/* word-wrap: break-word; */
			word-break: break-all;
		}

		strong, b {
			color: #37a2da
		}

		code {
			color: #ff0080;
			background: none;
			font-weight: bold;
		}
		blockquote{
			margin-left: 10px;
			margin-right: 0px;
			margin-top: 0px;
			margin-bottom: 0px;
		}

		p,
		ul,
		ol,
		li {
			margin: 0px;
			padding: 0px;
		}
	</style>
	<script type="module">
		let content = '';
		function connect() {
			let ws = new WebSocket(`ws://${location.hostname}:7071/ws`);
			ws.onmessage = (webSocketMessage) => {
				console.log('onmessage called');
				const messageBody = JSON.parse(webSocketMessage.data);
				content = messageBody.data;
				let cur_hour = new Date().getHours();
				let html=marked.parse(content.replace(new RegExp(`\n(${cur_hour}[ ]{0,1}:.*?)\r`), '\n<b>$1</b>\r'))
				document.getElementById('textarea').innerHTML = html;
			};
			ws.onclose = function (e) {
				console.log('Socket is closed. Reconnect will be attempted in 1 second.', e.reason);
				setTimeout(function () {
					connect();
				}, 1000);
			};
		}
		connect();

		function check() {
			let cur_hour = new Date().getHours();
			if (content.match(new RegExp(`\n${cur_hour}[ ]{0,1}:`))) {
				document.getElementById('textarea').style.backgroundColor = "#000000";
			} else {
				document.getElementById('textarea').style.backgroundColor = "#ff0000";
			}
			let html=marked.parse(content.replace(new RegExp(`\n(${cur_hour}[ ]{0,1}:.*?)\r`), '\n<b>$1</b>\r'))
			document.getElementById('textarea').innerHTML = html;
		}
		setInterval(check, 1000);

	</script>
</body>

</html>